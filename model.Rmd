---
title: "Model"
author: "Donghao Xue"
date: "05/04/2021"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(plyr)
library(reshape2)
library(tidyr)
library(viridis)
library(psych)
library(rstanarm)
library(arm)
library(randomForest)
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r }
oral = read.csv("oral_cancer_data.csv")

break1 = c(21840, 57160, 79640, 106760)
labels= c(1,2,3)
oral$Median.Household.Income = cut(oral$Median.Household.Income, break1, labels,include.lowest=T)
oral$Median.Household.Income = factor(oral$Median.Household.Income, levels = c(1,2,3))
oral$Sex = ifelse(oral$Sex == "Male", 1, 0)
oral$Race = factor(oral$Race, levels = c("White", "Asian or Pacific Islander", "Black", "Hispanic"))
```


## Including Plots

You can also embed plots, for example:

```{r }
#linear logistic model
m1 = glm(Match ~ Bachelors.Education +Sex + Race+ Insurance + Below.Poverty + Unemployed + Language.Isolation + Median.Household.Income + Sex:Race, data = oral, family = binomial(link = "logit"))
summary(m1)
coef(m1)
```

```{r message=FALSE, warning=FALSE }
#randomm forest
set.seed(1)
train = sample(1:nrow(oral), nrow(oral)/2)
trainset = oral[train,]
testset = oral[-train,]
m2 = randomForest(Match ~ Sex + Race + Age.at.Diagnosis + SEER.Registry + Insurance + Bachelors.Education + Below.Poverty + Unemployed + Language.Isolation + Median.Household.Income + Sex:Race , data = oral, subset = train, mtry = 3, importance = T)


```

```{r }
importance(m2)
```

```{r }
varImpPlot(m2)
```


```{r }
binnedplot(fitted(m1), residuals(m1))
```

```{r }
set.seed(1)
train = sample(1:nrow(oral), nrow(oral)/2)
trainset = oral[train,]
testset = oral[-train,]
```

```{r }
m1 = glm(Match ~ Bachelors.Education +Sex + Race+ Insurance + Below.Poverty + Unemployed + Language.Isolation + Median.Household.Income + Sex:Race, data = trainset, family = binomial(link = "logit"))
```

```{r }
set.seed(1)
probs = predict(m1, testset, type = "response")
pred.glm = rep(0, length(probs))
pred.glm[probs > 0.5] = 1
table(pred.glm, testset$Match)

```

```{r }
(98+1275)/(1992+1275+98+126)
```

```{r }

```

```{r }

```

```{r }

```


```{r }

```



























